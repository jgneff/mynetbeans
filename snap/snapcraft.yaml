# snapcraft.yaml - builds a Snap package of the Apache NetBeans IDE
# Copyright 2021-2022 John Neffenger
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: mynetbeans
title: My NetBeans
summary: Apache NetBeans IDE for the OpenJDK Snap
description: |
  Apache NetBeans is an integrated development environment (IDE)
  for Java, with extensions for other languages like PHP, C, C++,
  HTML5, and JavaScript. Applications based on NetBeans, including
  the NetBeans IDE, can be extended by third-party developers.

  This package provides the latest release of NetBeans built directly
  from its source code on GitHub. If the OpenJDK Snap package is also
  installed, this package connects to it during installation for the
  location of its Java Development Kit runtime and tools.

  For more information, see the repository for this package on GitHub:

  https://github.com/jgneff/mynetbeans

  This is a convenience binary of the Apache NetBeans IDE and not a
  release by the Apache Software Foundation. Official releases are at:

  https://netbeans.apache.org

  Apache NetBeans and the NetBeans logo are either registered
  trademarks or trademarks of the Apache Software Foundation in the
  United States and/or other countries.

version: '13'
license: Apache-2.0

base: core18
grade: stable
confinement: strict

architectures:
- build-on: amd64
  run-on: all

plugs:
  jdk-18-1804:
    interface: content
    target: $SNAP/jdk

apps:
  mynetbeans:
    command: bin/netbeans.sh
    extensions: [gnome-3-34]
    plugs: [home, network, network-bind]

parts:
  dump:
    plugin: dump
    source: .
    source-type: local
    stage: [bin, conf]

  netbeans:
    plugin: nil
    source: https://github.com/apache/netbeans.git
    source-type: git
    source-branch: release130
    source-depth: 1
    build-packages: [ant, default-jdk-headless]
    # See this file for the branch names and commits of each release:
    # https://github.com/apache/netbeans-jenkins-lib/blob/master/meta/netbeansrelease.json
    build-environment:
    - RELEASE_BRANCH: release130
    override-build: |
      ant -Dmetabuild.branch="$RELEASE_BRANCH" -quiet
      rm -f nbbuild/netbeans/*.built
      chmod a+r nbbuild/netbeans/etc/netbeans.conf
      mv nbbuild/netbeans "$SNAPCRAFT_PART_INSTALL"

layout:
  # For Fontconfig warnings and errors on startup
  /etc/fonts:
    bind: $SNAP/gnome-platform/etc/fonts
